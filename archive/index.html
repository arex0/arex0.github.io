---
title: "Archive"
keywords: [Archive,List]
description: "Arex0 Archive List"
---

<!DOCTYPE html>
<html lang='zh-Hans'>
<head>
<noscript><meta http-equiv='refresh' content='0; url=shot'></noscript>
{%- include meta.html -%}
<script>
    let windowInnerHeight=window.innerHeight
    let metaEl=document.querySelector('#viewportMeta')
    metaEl.setAttribute('name','viewport')
    metaEl.setAttribute('content',`height=${windowInnerHeight},width=device-width,initial-scale=1.0,user-scalable=no`)
    window.addEventListener('resize',()=>{
        if((window.innerHeight<windowInnerHeight*.9)&&(window.innerHeight>windowInnerHeight*.8)){
            windowInnerHeight=window.innerHeight
            metaEl.setAttribute('content',`height=${windowInnerHeight},width=device-width,initial-scale=1.0,user-scalable=no`)
        }
    })
    const themes=['light','dark']
    function theme(i) {
        let theme=localStorage.getItem('theme')
        document.body.classList.remove(theme)
        theme=themes[(themes.indexOf(theme||'light')+i) % themes.length]
        localStorage.setItem('theme',theme)
        document.body.classList.add(theme)
    }
    let snapObserver = null
    function jump(url) {
        snapObserver.disconnect()
        document.activeElement.blur()
        document.querySelector('footer').style.opacity=0
        setTimeout(()=>{
            document.querySelector('main').style.opacity=0
            document.getElementById('controller').style.opacity=0
        },200)
        setTimeout(()=>location.href=url,400)
    }
    function snap(e) {
        snapObserver = new IntersectionObserver(([{intersectionRatio:i}])=>window.autoscrolling=(window.autoscrolling === false) ? (i > 0.01)&&(i < .99)&&(scrollBy({top:Math.sign(i - .5) * -e.scrollHeight*.99,behavior:'smooth'}),true) :(window.autoscrolling === true) ? false :((i > 0.01)&&(i < .99)),{threshold:[0.01,0.99]})
        snapObserver.observe(e)
    }
    var loaded = false
    function pageshow(){
        setTimeout(()=>{
            document.querySelector('main').style.opacity=1
            if(loaded) document.getElementById('controller').style.opacity=1
            setTimeout(()=>{
                document.querySelector('footer').style.opacity=1
                snap(document.querySelector('footer'))
            },200)
        },100)
    }
    function smsrcoll(h){
        scrollTo({top:h,behavior:'smooth'})
    }
    window.addEventListener('pageshow',pageshow);
    window.StylePropertyMap&&document.addEventListener('DOMContentLoaded',()=>{
        let ctl=document.getElementById('controller'),
            h=nav.offsetHeight,
            pre=document.documentElement.scrollTop,
            chidden = CSS.number(0),
            cshow = CSS.number(1),
            showing = true
        function autoShowControls() {
            let cur=document.documentElement.scrollTop
            if(cur>pre+h){
                pre=cur
                if(showing){
                    ctl.attributeStyleMap.set('opacity',chidden)
                    showing = false
                }
            }else if(cur+32<pre){
                pre=cur
                if(showing) return
                ctl.attributeStyleMap.set('opacity',cshow)
                showing = true
            }
        }
        window.addEventListener('scroll',()=>requestAnimationFrame(autoShowControls));
    },{once:true})
</script>
{%- include style-default.html -%}
<style>
    main>ul {
        padding: 0;
        list-style: none;
    }

    li {
        min-height: unset;
        overflow: hidden;
    }

    .card {
        display: block;
        margin: .8em;
        padding: .8em .8em .5em;
        background: hsl(var(--background));
        color: inherit;
        border: .5px solid hsla(var(--color), .2);
        box-shadow: 0 0 2px hsla(var(--color), .25);
        width: 80vmin;
        font: inherit;
        text-decoration: none;
        cursor: pointer;
        filter: brightness(1.01);
    }

    .card>div:nth-child(2) {
        font-size: .6em;
    }

    .card>div:nth-child(3) {
        font-size: .5em;
    }

    .card>div:nth-child(3)>span {
        display: inline-block;
        height: 1.5em;
        min-height: unset;
        overflow: hidden;
        margin-right: calc(.5em + 1vw);
    }

    .card>div:nth-child(3)>span:first-child::before {
        content: '⏲ ';
    }

    .card>div:nth-child(3)>span:nth-child(2)::before {
        content: '👁 ';
    }

    .card>div:nth-child(3)>span:nth-child(3)::before {
        content: '❤ ';
    }

    .card>div:nth-child(3)>span>img {
        max-width: 4em;
        height: 1em;
        min-height: unset;
        transform: translateY(-1.99em);
        filter: drop-shadow(0 2em hsl(var(--color)));
    }

    #controller {
        display: flex;
        position: fixed;
        top: 3em;
        z-index: 3;
        opacity: 0;
        font-size: .9em;
        transition: opacity .3s;
        pointer-events: none;
        contain: layout style;
        transition: opacity .2s ease-in-out;
    }

    #spread {
        width: 100vmin;
    }

    .wrapper {
        display: flex;
        width: calc(50vmax - 50vmin);
        justify-content: center;
        min-width: 6em;
    }

    #sorter {
        display: flex;
        height: max-content;
        justify-content: center;
        flex-direction: column;
        pointer-events: all;
    }

    #sorter::before {
        content: 'Sort By:';
    }

    #filter {
        display: flex;
        height: max-content;
        flex-flow: row wrap;
        pointer-events: all;
    }

    #filter::before {
        width: 100%;
        content: 'Filter By:';
    }

    #filter::after {
        width: 100%;
        content: attr(data-number);
    }

    #sorter>span {
        width: 5em;
    }

    #sorter>span,
    #filter>span {
        margin: .2em;
        padding: 0 .25em;
        background-color: hsla(var(--color), .02);
        color: hsla(var(--color), .6);
        border: solid .1em hsla(var(--color), .6);
        box-sizing: border-box;
        height: 1em;
        text-align: center;
        line-height: 1em;
        cursor: pointer;
        border-radius: .25em;
        user-select: none;
    }

    #filter>span:not([exist]) {
        background-color: hsla(var(--color), .01);
        color: hsla(var(--color),.15);
        border: solid .1em hsla(var(--color), .15);
    }

    #sorter>span[selected='true'],
    #filter>span[selected='true'] {
        background-color: hsla(var(--color), .2);
        color: hsl(var(--color));
    }

</style>
</head>
<body id='focus' style='display:flex;position:relative;margin:0;z-index:0;background-color:hsl(var(--background));color:hsl(var(--color));font:calc(16px + 1vh) monaco,consolas,monospace;overflow-y:scroll;flex-direction:column'>
{%- include nav.html -%}
{%- include footer.html -%}
{%- include fabs.html -%}
<main style='position:relative;z-index:1;background:hsl(var(--background));min-height:calc(100vh - 1.7em);margin-top:1.7em;opacity:0;contain:layout style;transition:opacity .2s ease-in-out;display:flex;justify-content:center' onclick='document.body.firstElementChild.removeAttribute("open")'>
    <ul>
        <template id='template'>
            <li>
                <a class='card'><div></div>
                <div></div>
                <div>
                    <span></span>
                    <span>-</span>
                    <span>-</span>
                </div></a>
            </li>
        </template>
    </ul>
</main>
<div id='controller'>
    <div class='wrapper'>
        <div id='sorter'>
            <span draggable='true'>created</span>
            <span draggable='true'>modified</span>
            <span draggable='true'>like</span>
            <span draggable='true'>visit</span>
        </div>
    </div>
    <div id='spread'></div>
    <div class='wrapper'>
        <div id='filter'>
        </div>
    </div>
</div>
</body>
<script>
    theme(0)
    let logo=document.querySelector('.logo')
    logo.addEventListener('pointerdown',()=>logo.setAttribute("open",true),{passive:true})
    logo.addEventListener('touchstart',()=>logo.setAttribute("open",true),{passive:true})//for firefox
    pageshow()
    let actions={
        '主题':event=>theme(1),
        '主页':()=>jump('/'),
        '顶部':()=>scrollTo({top:0,behavior:'smooth'}),
        '底部':()=>scrollTo({top:document.documentElement.clientHeight,behavior:'smooth'}),
    }
    function zero(command){
        let match=false
        Object.entries(actions).forEach(([flag,action])=>command.includes(flag)&&(match=true)&&action(command))
    }
    function SortByCount(array){
        let counter = {}, mapper = []
        array.forEach(i=>counter[i] = (counter[i]||0)+1)
        Object.entries(counter).forEach(([k,v])=>{
            if(mapper[v]) mapper[v].push(k)
            else mapper[v] = [k]
        })
        return mapper.filter(i=>i).reverse().flat()
    }
    let template = document.getElementById('template'), ctl = document.getElementById('controller'), filter = document.getElementById('filter')
    let blogs = {}, pathList = [], onread = {}, filters = {}, filterList = [], sortby, vlc = {}//visit_like_count
    function card(value){
        let c = template.content.cloneNode(true)
        let a = c.querySelector('a')
        a.href = value.path
        a.onclick = e => {e.preventDefault(),jump(value.path)}
        a.children[0].innerHTML = value.name
        a.children[1].innerHTML = value.description
        a.children[2].children[0].innerHTML = value.created
        let v = vlc['/visit_count'+value.path]
        if(v!=undefined){
            a.children[2].children[1].childNodes[0].replaceWith(document.createTextNode(v))
        }else{
            onread['/visit_count'+value.path] = v =>{
                delete onread['/visit_count'+value.path]
                a.children[2].children[1].childNodes[0].replaceWith(document.createTextNode(v))
            }
        }
        let l = vlc['/like_count'+value.path]
        if(l!=undefined){
            a.children[2].children[2].childNodes[0].replaceWith(document.createTextNode(l))
        }else{
            onread['/like_count'+value.path] = l =>{
                delete onread['/like_count'+value.path]
                a.children[2].children[2].childNodes[0].replaceWith(document.createTextNode(l))
            }
        }
        return c.children[0]
    }
    function updateView(){
        let p = document.createElement('ul'), ul = document.querySelector('main>ul')
        let KeywordsCollector = {}
        ctl.querySelectorAll('[exist]').forEach(p=>p.removeAttribute('exist'))
        let list = pathList.filter(path=>{
            let ws = blogs[path].keywords
            return filterList.every(w=>ws.includes(w))
        })
        filter.setAttribute('data-number',list.length+' Result')
        list.forEach(path=>{
            let blog = blogs[path]
            blog.keywords.forEach(w=>KeywordsCollector[w]=true)
            p.appendChild(blog.dom)
        })
        Object.keys(KeywordsCollector).forEach(w=>filters[w].setAttribute('exist','true'))
        scrollTo({top:0})
        ul.replaceWith(p)
        /*.sort((p1,p2)=>{
            let b1 = blogs[p1], b2 = blogs[p2]
            return 
        })*/
    }
    fetch('/archive/list.json').then(res=>res.json()).then(list=>{
        loaded = true
        ctl.style.opacity=1
        list.forEach(json=>{
            blogs[json.path] = json
            pathList.push(json.path)
            blogs[json.path].dom = card(json)
        })
        let KeywordsCounter = []
        pathList.forEach(path=>{Array.prototype.push.apply(KeywordsCounter,blogs[path].keywords)})
        SortByCount(KeywordsCounter).forEach(w=>{
            let t = document.createElement('span')
            t.innerHTML = w
            t.onclick = () =>{
                if(t.getAttribute('selected')=='true'){
                    t.setAttribute('selected','false')
                    filterList.splice(filterList.findIndex(p=>p==w),1)
                }else{
                    t.setAttribute('selected','true')
                    filterList.push(w)
                }
                updateView()
            }
            filter.appendChild(filters[w] = t)
        })
        updateView()
        //ArchiveExplorer.Show()
        //ArchiveExplorer.Archives(location.search.slice(1).split('&').map(q => q.split('=')).reduce((q, p)=>({...q,[p[0]]:q.hasOwnProperty(p[0])?[...q[p[0]], p[1]]:[p[1]]}),{}))
    })
    fetch('https://phlashing.me/visit_like_count',{mode:'cors'}).then(res=>res.text())
    .then(text=>{
        text.slice(0,-1).split('\n').map(JSON.parse).forEach(json=>{
            let key = Object.keys(json)[0]
            if(!blogs[key]){blogs[key] = {}}
            if(key.startsWith('/like_count')){
                blogs[key.slice(11)]['like'] = json[key]
            }else if(key.startsWith('/visit_count')){
                blogs[key.slice(12)]['visit'] = json[key]
            }
        })
        //ArchiveExplorer.allow vlc sort
    })
</script>
<script>
const ArrayMethods = Array.prototype
const hypot = (p1, p2) => Math.hypot(p1.pageX - p2.pageX, p1.pageY - p2.pageY)
const copyTouch = touch => ({ id: touch.identifier, pageX: touch.pageX, pageY: touch.pageY })
const findTouch = (touches, id) => ArrayMethods.find.call(touches, ({ identifier }) => identifier == id)
function on(ele,type,handle,opts){ele.addEventListener(type,handle,opts)}
function un(ele,type,handle,opts){ele.removeEventListener(type,handle,opts)}
function draggable(ele){
    let touch = null
    on(ele,'contextmenu',e=>e.preventDefault())
    on(ele,'touchstart',e=>{
        if (touch) return
        let cancel = false,
            u = e.changedTouches.length-1,
            tc = e.changedTouches[u]
        touch = copyTouch(tc)
        function cancelDrag(e){
            if(e.type!='touchstart'&&touch&&e.type=='touchmove'&&ArrayMethods.every.call(e.changedTouches,tc=>hypot(tc,touch)>50)) return
            cancel = true
            touch = null
        }
        on(document,'touchstart',()=>on(document,'touchstart',cancelDrag,{once:true}),{once:true})
        on(document,'touchmove',cancelDrag,{passive:false})
        on(document,'touchend',cancelDrag,{once:true})
        on(document,'touchcancel',cancelDrag,{once:true})
        setTimeout(()=>{
            un(document,'touchcancel',cancelDrag,{once:true})
            un(document,'touchend',cancelDrag,{once:true})
            un(document,'touchmove',cancelDrag,{passive:false})
            un(document,'touchstart',cancelDrag,{once:true})
            if(!cancel){
                let shadow = ele.cloneNode(true), style = shadow.style
                    src = ele.getBoundingClientRect(), srcX = src.x, srcY = src.y,
                    baseX = tc.pageX, baseY = tc.pageY
                Object.entries(getComputedStyle(ele)).forEach(([attr,val])=>{style[attr] = val})
                style.position = 'fixed'
                style.left = srcX+'px'
                style.top = srcY+'px'
                style.opacity = parseFloat(document.body.style.opacity||1) * 0.5
                style.pointerEvents = 'none'
                style.zIndex = 999
                document.body.appendChild(shadow)

                let target = null, overTimer = null, fireover = true
                function getElementByPoint(e){
                    let el = document.elementFromPoint(e.clientX, e.clientY)
                    while (el && getComputedStyle(el).pointerEvents == 'none') {
                        el = el.parentElement;
                    }
                    return el;
                }
                function dispatchEvent(e){
                    shadow.remove()
                    let t = getElementByPoint(e)
                    document.body.appendChild(shadow)
                    let init = {
                        screenX: e.screenX,
                        screenY: e.screenY,
                        clientX: e.clientX,
                        clientY: e.clientY,
                        pageX: e.pageX,
                        pageY: e.pageY,
                    }
                    if(t!=target){
                        init.relatedTarget = target
                        t.dispatchEvent(new DragEvent('dragenter',init))
                        init.relatedTarget = t
                        target.dispatchEvent(new DragEvent('dragleave',init))
                        target = t
                        init.relatedTarget = null
                    }
                    clearInterval(overTimer)
                    target.dispatchEvent(new DragEvent('dragover',init))
                    overTimer = setInterval(()=>target.dispatchEvent(new DragEvent('dragover',init)),350)
                }
                function RenderDragMove(e){
                    ele.dispatchEvent(new DragEvent('drag',e))
                    shadow.style.left = srcX-baseX+e.pageX+'px'
                    shadow.style.top  = srcY-baseY+e.pageY+'px'
                }
                function DragMove(e){
                    let t = findTouch(e.changedTouches,touch.id)
                    if (t){
                        e.preventDefault()
                        e.stopPropagation()
                        requestAnimationFrame(()=>{
                            dispatchEvent(t)
                            RenderDragMove(t)
                        })
                    }
                }
                function DragEnd(e){
                    let t = findTouch(e.changedTouches,touch.id)
                    if(t&&(t.identifier==touch.id)){
                        touch = null
                        shadow.remove()
                        shadow = null
                        clearInterval(overTimer)
                        target.dispatchEvent(new DragEvent('drop',{
                            screenX: t.screenX,
                            screenY: t.screenY,
                            clientX: t.clientX,
                            clientY: t.clientY,
                            pageX: t.pageX,
                            pageY: t.pageY,
                        }))
                        ele.dispatchEvent(new DragEvent('dragend',t))
                        un(document,'touchcancel',DragEnd)
                        un(document,'touchend',DragEnd)
                        un(document,'touchmove',DragMove,{passive:false})
                    }
                }
                ele.dispatchEvent(new DragEvent('dragstart', tc))
                ele.dispatchEvent(new DragEvent('dragenter',tc))
                target = ele
                let evt = new DragEvent('dragover',{
                    screenX: e.screenX,
                    screenY: e.screenY,
                    clientX: e.clientX,
                    clientY: e.clientY,
                    pageX: e.pageX,
                    pageY: e.pageY,
                })
                ele.dispatchEvent(evt)
                overTimer = setInterval(()=>ele.dispatchEvent(evt),350)
                on(document,'touchmove',DragMove,{passive:false})
                on(document,'touchend',DragEnd)
                on(document,'touchcancel',DragEnd)

            }
        },300)
    })
}
document.querySelectorAll('[draggable="true"]').forEach(draggable)
let sortID = 0
document.querySelectorAll('#sorter [draggable="true"]').forEach(ele=>{
    ele.setAttribute('sort-id', sortID++)
    on(ele,'dragstart',e=>{
        e.dataTransfer.setData('text/plain', ele.getAttribute('sort-id'))
    })
    on(ele,'dragover',e=>e.preventDefault())
    on(ele,'drop',e=>{
        let t = e.target, rect = t.getBoundingClientRect(), next = (e.clientY - rect.top)/(rect.bottom - rect.top) > .5
        if(next&&!t.nextElementSibling){
            t.parentNode.appendChild(document.querySelector(`[sort-id="${e.dataTransfer.getData('text/plain')}"]`))
        }else{
            t.parentNode.insertBefore(document.querySelector(`[sort-id="${e.dataTransfer.getData('text/plain')}"]`), next && t.nextElementSibling || t)
        }
    })
})
let sorter = document.getElementById('sorter')
const sortObserver = new MutationObserver(e=>{
    console.log(sorter.children)
})
sortObserver.observe(sorter,{childList: true})
</script>
</html>